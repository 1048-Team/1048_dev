on_actions = {

	on_declare_war = {
		effect = {
			if = {
				limit = {
					tag = CCA
					FROM = { tag = CHN }
				}
				news_event = changelingianews.3
			}
			else_if = { #CHN war news events
				limit = {
					tag = BUG
					FROM = { tag = SLE }
				}
				news_event = changelingianews.6
			}
			#MTS no call on offensive war, yes call on defensive war
			else_if = {
				limit = {
					FROM = {
						OR = {
							AND = {
								tag = MTS
								has_government = communism
								is_in_faction_with = SCS
							}
							AND = {
								tag = SCS
								is_in_faction_with = MTS
							}
						}
						has_defensive_war_with = ROOT
					}
				}
				if = {
					limit = {
						has_idea = MTS_no_friends_calling_offensive
					}
					remove_ideas = MTS_no_friends_calling_offensive
				}
			}
		}
	}
	
	on_unit_leader_promote_from_ranks_veteran = { #Unit leader scope, FROM is unit
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_promote_from_ranks_veteran"
			owner = {
				set_temp_variable = {
					creator = THIS
				}
			}
			assign_FH_general_flavour_traits = yes
		}
	}

	on_unit_leader_promote_from_ranks_green = { #Unit leader scope, FROM is unit
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_unit_leader_promote_from_ranks_green"
			owner = {
				set_temp_variable = {
					creator = THIS
				}
			}
			assign_FH_general_flavour_traits = yes
		}
	}
	
	#ROOT is winner #FROM is loser
	on_peaceconference_ended = { #For adding prosperity modifier to MTS Warm Night conquered states
		effect = {
			# PUT EVERYTHING IN THE IF BELOW
			if = { # THE bypass_on_peaceconference_ended FLAG **HAS** TO BE SET BEFORE CALLING THE white_peace COMMAND AND CLEARED AFTERWARDS
				limit = {
					NOT = {
						has_country_flag = bypass_on_peaceconference_ended
						FROM = { has_country_flag = bypass_on_peaceconference_ended }
					}
				}
				log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_peaceconference_ended"
				every_state = {
					limit = {
						ROOT = { has_country_leader = { character = MTS_Warm_Night ruling_only = yes } }
						is_owned_by = ROOT
						NOT = { has_dynamic_modifier = { modifier = MTS_state_prosperity_modifier } }
					}
					add_dynamic_modifier = { modifier = MTS_state_prosperity_modifier }
				}
				#Should later do news events for SLE wars with CHN
				if = {
					limit = {
						tag = CCA
						FROM = { tag = CHN }
					}
					ROOT = { country_event = changeling_activity.38 }
				}
				else_if = { #CHN end war news
					limit = {
						tag = BUG
						FROM = { tag = SLE }
					}
					news_event = changelingianews.7
				}
				else_if = { #Figure out image for Ordo management
					limit = {
						OR = {
							is_EQS_SOL_1048 = yes
							is_SLW_SOL = yes
							is_MTS_SOL = yes
						}
					}
					SOL_calculate_ordo_image = yes
				}
				#Return MTS/SCS to not call in offensive wars
				else_if = {
					limit = {
						ROOT = { 
							NOT = { 
								has_idea = MTS_no_friends_calling_offensive
								OR = {
									AND = {
										tag = MTS
										has_government = communism
										is_in_faction_with = SCS
									}
									AND = {
										tag = SCS
										is_in_faction_with = MTS
									}
								}
							} 
						}
					}
					add_ideas = MTS_no_friends_calling_offensive
				}
				###Begins the long list of integration stuff
				else_if = {
					limit = {
						ROOT = {
							tag = MTS
							is_subject = no
						}
						FROM = {
							OR = {
								tag = EQS
								tag = SLW
								tag = CRY
								is_in_array = { global.changeling_hegemony = THIS.id }
								AND = {
									is_in_array = { global.shield_of_steel = THIS.id }
									NOT = { tag = MWR }
								}
								is_in_array = { global.solar_empire_rumps = THIS.id }
							}
						}
					}
					FROM = { add_to_ROOT_potential_cores = yes }
				}
				else_if = { #ABY-YMN war and YMN stuffs
					limit = {
						ROOT = {
							OR = {
								original_tag = ABY
								original_tag = YMN
							}
						}
					}
					if = {
						limit = {
							FROM = {
								OR = {
									original_tag = ABY
									original_tag = YMN
								}
							}
						}
						FROM = { add_to_ROOT_potential_cores = yes }
					}
					else_if = {
						limit = {
							any_other_country = {
								is_in_array = { ROOT.i_will_kill_you_later = THIS }
							}
						}
						country_event = {
							id = zebrica_activity.23
							days = 120
						}
					}
					else = { clear_array = ROOT.i_will_kill_you_later }
				}
			
				FROM = { country_event = { id = utility.10 hours = 1 } }
				
				update_global_arrays_all = yes
			}
		}
	}

	
	# ROOT is capitulated country, FROM is winner
	# This is processed by the game DURING peace conference
	# If you have any effects that annex/change state ownership, DO NOT put them here
	# as that will crash the peace conference
	on_capitulation = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_capitulation"
			if = {
				limit = {
					OR = {
						original_tag = CNT
						original_tag = TAI
						original_tag = MEL
						original_tag = ZOO
					}
					FROM = {
						has_focus_tree = generic_zebra_focus
						is_ai = yes
					}
				}
				set_country_flag = { flag = bypass_on_peaceconference_ended days = 1 value = 1 } #this should be removed if you wanna add something for ABY, YMN, MGY
				transfer_navy = { target = FROM }
			}
		}
	}

	# scope is operative
	# from scope is the country
	on_operative_recruited = {
		effect = {
			log = "[GetDateText]: ROOT: [Root.GetName] FROM: [From.GetName] on_operative_recruited by FH_on_actions"
			operative_add_starting_nationalities_and_race = yes
			operative_add_secondary_nationalities = yes
			if = {
				limit = {
					FROM = {
						OR = {
							original_tag = EQS
							is_in_faction_with = EQS
						}
					}
					has_trait = operative_agentbio_astrum
				}
				save_global_event_target_as = SLE_astrum_solus_target
			}
		}
	}

	# EEEEEEEEEEEEEEEE
	# Shouldn't need to fiddle with this. Wiki says only fires once, once first at war; won't fire again unless at peace first
	# THIS is the country that is now in a state of war
	on_war = {
		effect = {
			log = "[GetDateText]: THIS: [THIS.GetName]: on_war"
			if = {
				limit = {
					tag = EEE
					has_country_flag = EEE_ezmetzli_coup
					is_subject = no
				}
				add_to_variable = { EEE_doom_rate = -1 }
			}
		}
	}

	# THIS is the country that is now at peace
	on_peace = {
		effect = {
			log = "[GetDateText]: THIS: [THIS.GetName]: on_peace"
			if = {
				limit = {
					tag = EEE
					has_country_flag = EEE_ezmetzli_coup
					is_subject = no
				}
				add_to_variable = { EEE_doom_rate = 1 }
			}
		}
	}
}
