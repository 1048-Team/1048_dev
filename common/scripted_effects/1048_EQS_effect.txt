#Root is EQS
SOL_Celestia_Returned = {
	add_named_threat = {
		threat = 8.5
		name = EQS_Daybreakers_bipolar
	}
	EQS = {
		clr_country_flag = daybreaker_crisis
	}
	end_puppet = WHY
	remove_from_faction = WHY
	dismantle_faction = yes
	WHY = {
		drop_cosmetic_tag = yes
	}
	retire_country_leader = yes
	EQS_Plures_Ordines_Cultus = { promote_character = yes }
	every_state = {
		limit = {
			OR = {
				state = 184
				state = 187
				state = 223
				state = 188
				state = 185
				state = 108
				state = 110
				state = 12
				state = 75
			}
		}
		add_core_of = SLW
	}
	every_state = {
		limit = {
			NOT = { is_core_of = SLW }
			OR = {
				is_claimed_by = EQS
				is_core_of = EQS
			}
		}
		add_claim_by = SLW
	}
	every_state = {
		limit = {
			is_core_of = SLW
		}
		SLW = { transfer_state = PREV }
	}
	every_state = {
		limit = {
			is_controlled_by = SLW
		}
		teleport_armies = {
			limit = { tag = EQS }
		}
	}
	EQS = {
		transfer_ship = {
			prefer_name = "HMS Harmony in Order"
			type = battleship
			target = SLW
		}
		transfer_ship = {
			prefer_name = "HMS Ravager"
			type = battleship
			target = SLW
		}
		transfer_ship = {
			type = destroyer
			target = SLW
		}
		transfer_ship = {
			type = destroyer
			target = SLW
		}
		transfer_ship = {
			type = destroyer
			target = SLW
		}
		transfer_ship = {
			type = destroyer
			target = SLW
		}
		transfer_ship = {
			type = destroyer
			target = SLW
		}
		transfer_ship = {
			type = destroyer
			target = SLW
		}
		transfer_ship = {
			type = destroyer
			target = SLW
		}
		transfer_ship = {
			type = destroyer
			target = SLW
		}
		transfer_ship = {
			type = light_cruiser
			target = SLW
		}
		transfer_ship = {
			type = light_cruiser
			target = SLW
		}
		transfer_ship = {
			type = battle_cruiser
			target = SLW
		}
	}
	
	set_politics = {
		ruling_party = democratic
		elections_allowed = no
	}
	event_target:EQS_Sunbutt_target = { promote_character = yes }
	set_popularities = {
		democratic = 45
		fascism = 30
		communism = 5
		neutrality = 20
	}
	set_party_name = {
		ideology = democratic
		name = EQS_Celestia_democratic_party
		long_name = EQS_Celestia_democratic_party
	}
	drop_cosmetic_tag = yes
	set_country_flag = equestria_returned
	remove_ideas = {
		EQS_solar_cult
		EQS_solar_inquisition
	}
	IF = {
		limit = {
			has_idea = EQS_heretical_commanders
		}
		remove_ideas = EQS_heretical_commanders
	}
	IF = {
		limit = {
			has_idea = EQS_purified_high_command
		}
		remove_ideas = EQS_purified_high_command
	}
	load_oob = "SOL_civil_war_cel"
	event_target:EQS_Midwinter_Halo_target = { set_nationality = SLW }
	event_target:EQS_Swift_Wing_target = { set_nationality = SLW }
	event_target:EQS_Orion_Star_target = { set_nationality = SLW }
	event_target:EQS_dust_hoover_target = { set_nationality = SLW }
	event_target:EQS_Bellum_Iceheart_target = { set_nationality = SLW }
	event_target:EQS_Molten_Song_target = { set_nationality = SLW }
	event_target:EQS_evening_squall_target = { set_nationality = SLW }
	event_target:EQS_Nova_Glow_target = { set_nationality = SLW }
	IF = {
		limit = { 
			has_country_flag = aurora_general
		}
		clr_country_flag = aurora_general
	}
	add_ideas = eqs_slw_civil_war
	IF = {
		limit = {
			has_country_flag = starlight_and_trixie_corrupted
		}
		event_target:EQS_Starlight_Glimmer_target = { set_nationality = SLW }
		event_target:EQS_Trixie_Lulamoon_target = { set_nationality = SLW }
	}
	SLW = {
		add_ideas = eqs_slw_civil_war
		IF = {
			limit = { country_exists = EQS }
			create_wargoal = {
				type = annex_everything
				target = EQS
			}
			declare_war_on = {
				target = EQS type = annex_everything
			}
		}
		load_oob = "SLW_civil_war"
		country_event = solarordo.25
		set_variable = { equestria_conquest = 9 }
		IF = {
			limit = {
				EQS = { has_intelligence_agency = yes }
			}
			create_intelligence_agency = {
				name = "Solaris Speculatores"
				icon = GFX_intelligence_agency_logo_eqs_sol
			}
		}
	}
	transfer_technology = yes
	load_focus_tree = solar_empire_celestia_focus
}

SOL_end_of_civil_war_CEL = {
	IF = {
		limit = {
			NOT = { has_country_flag = blueblood_arrested }
		}
		custom_effect_tooltip = blueblood_arrested_tt
		set_country_flag = blueblood_arrested
	}
	IF = {
		limit = {
			NOT = { has_country_flag = sunset_arrested }
		}
		custom_effect_tooltip = sunset_arrested_tt
		set_country_flag = sunset_arrested
	}
	IF = {
		limit = {
			event_target:EQS_Sunbutt_target = { is_unit_leader = no }
		}
		event_target:EQS_Sunbutt_target = {
			add_field_marshal_role = {
				traits = { pony_race_trait pleasant_sun inspirational_leader }
				skill = 2
				attack_skill = 3
				defense_skill = 3
				planning_skill = 2
				logistics_skill = 2
			}
		}
	}
	IF = {
		limit = {
			NOT = {
				has_completed_focus = EQS_addressing_the_faithful_generals
			}
		}
		set_country_flag = harmonist_commanders_return
	}
	swap_ideas = {
		add_idea = EQS_destitute_diarchy
		remove_idea = EQS_great_war_aftermath
	}
	hidden_effect = {
		IF = {
			limit = {
				has_completed_focus = EQS_addressing_the_faithful_generals
			}
			delete_unit_template_and_units = {
				division_template = "Equestrian Veterans"
			}
			delete_unit_template_and_units = {
				division_template = "Starlight's Remnants"
			}
		}
		IF = {
			limit = {
				has_completed_focus = EQS_salvation_to_the_lost
			}
			delete_unit_template_and_units = {
				division_template = "Solar Deserters"
			}
		}
	}
	custom_effect_tooltip = remove_solar_civil_war_divisions_tt
	add_stability = -0.05
	add_war_support = -0.15
	set_country_flag = end_of_equestria_civil_war
	set_country_flag = rescued_harmonic_advisors
	clr_country_flag = starlight_and_trixie_corrupted
	mark_focus_tree_layout_dirty = yes
}
SOL_end_of_civil_war_SLW = {
	custom_effect_tooltip = SLW_searching_for_leader_tt
	hidden_effect = {
		every_state = {
			limit = {
				is_core_of = EQS
			}
			add_core_of = SLW
		}
		IF = {
			limit = { has_country_flag = accepted_commie_help }
			delete_unit_template_and_units = {
				division_template = "Smoldering Carbon's Unionists"
				disband = yes
			}
		}
		set_variable = { equestria_conquest = 0 }
		country_event = {
			id = solarwar.11
			days = 14
			random_days = 7
		}
		country_event = {
			id = solarwar.87
			days = 180
			random_days = 210
		}
		set_country_flag = SLW_searching_for_prefectess
		mark_focus_tree_layout_dirty = yes
	}
	add_stability = -0.035
	add_war_support = -0.065
	custom_effect_tooltip = SLW_solar_empire_generals_tt
	hidden_effect = {
		event_target:EQS_Blueblood_target = { set_nationality = ROOT }
		event_target:EQS_Aurora_Shinespark_target = { set_nationality = ROOT }
		event_target:EQS_Sunset_Shimmer_target = { set_nationality = ROOT }
		event_target:EQS_Luminous_Blade_target = { set_nationality = ROOT }
		event_target:EQS_Scorched_Earth_target = { set_nationality = ROOT }
		event_target:EQS_Sun_Marble_target = { set_nationality = ROOT }
		event_target:EQS_Locust_Glow_target = { set_nationality = ROOT }
	}
}

EQS_destroy_solar_temple = {
	IF = {
		limit = {
			check_variable = { var = EQS_temple_construction value = 20 compare = greater_than_or_equals }
			NOT = { check_variable = { EQS_temple_construction < 20 } }
			has_country_flag = EQS_finishing_touches
		}
		four_random_industrial_complex = yes
		add_resource = { type = steel amount = 15 state = 3 }
		add_resource = { type = crystals amount = 6 state = 3 }
		add_resource = { type = steel amount = 6 state = 12 }
	}
	IF = {
		limit = {
			check_variable = { var = EQS_temple_construction value = 20 compare = greater_than_or_equals }
			NOT = { check_variable = { EQS_temple_construction < 20 } }
			NOT = { has_country_flag = EQS_finishing_touches }
		}
		four_random_industrial_complex = yes
		add_resource = { type = steel amount = 12 state = 3 }
		add_resource = { type = crystals amount = 4 state = 3 }
	}
	IF = {
		limit = {
			NOT = { check_variable = { var = EQS_temple_construction value = 20 compare = greater_than_or_equals } }
			check_variable = { var = EQS_temple_construction value = 15 compare = greater_than_or_equals }
			NOT = { check_variable = { EQS_temple_construction < 15 } }
		}
		three_random_industrial_complex = yes
		add_resource = { type = steel amount = 12 state = 3 }
	}
	IF = {
		limit = {
			NOT = { check_variable = { var = EQS_temple_construction value = 15 compare = greater_than_or_equals } }
			check_variable = { var = EQS_temple_construction value = 10 compare = greater_than_or_equals }
			NOT = { check_variable = { EQS_temple_construction < 10 } }
		}
		two_random_industrial_complex = yes
		add_resource = { type = steel amount = 9 state = 3 }
	}
	IF = {
		limit = {
			NOT = { check_variable = { var = EQS_temple_construction value = 10 compare = greater_than_or_equals } }
			check_variable = { var = EQS_temple_construction value = 1 compare = greater_than_or_equals }
		}
		one_random_industrial_complex = yes
		add_resource = { type = steel amount = 6 state = 3 }
	}
	IF = {
		limit = {
			check_variable = { EQS_temple_construction = 0 }
		}
		add_resource = { type = steel amount = 4 state = 3 }
	}
}